<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ProductAI - 함께 만드는 제품 디자인</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        .chat-container {
            width: 100%;
            max-width: 800px;
            height: 90vh;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.2);
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        /* Header */
        .chat-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px 24px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .header-left {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .ai-avatar {
            width: 40px;
            height: 40px;
            background: rgba(255,255,255,0.2);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
        }

        .ai-info h3 {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 2px;
        }

        .ai-status {
            font-size: 14px;
            opacity: 0.8;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .status-dot {
            width: 6px;
            height: 6px;
            background: #10B981;
            border-radius: 50%;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        .project-info {
            text-align: right;
            font-size: 14px;
            opacity: 0.9;
        }

        /* Setup vs Progress */
        .setup-container {
            background: #F8FAFC;
            padding: 16px 24px;
            border-bottom: 1px solid #E2E8F0;
        }

        .setup-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
        }

        .setup-title {
            font-size: 14px;
            font-weight: 600;
            color: #374151;
        }

        .setup-indicator {
            font-size: 12px;
            color: #6B7280;
            background: #E5E7EB;
            padding: 4px 8px;
            border-radius: 12px;
        }

        .setup-steps {
            display: flex;
            gap: 8px;
            align-items: center;
        }

        .setup-step {
            padding: 4px 12px;
            border-radius: 16px;
            font-size: 12px;
            font-weight: 500;
            transition: all 0.3s ease;
        }

        .setup-step.completed {
            background: #10B981;
            color: white;
        }

        .setup-step.active {
            background: #3B82F6;
            color: white;
        }

        .setup-step.pending {
            background: #E5E7EB;
            color: #6B7280;
        }

        /* Progress Container */
        .progress-container {
            background: #F8FAFC;
            padding: 16px 24px;
            border-bottom: 1px solid #E2E8F0;
            display: none;
        }

        .progress-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
        }

        .progress-title {
            font-size: 14px;
            font-weight: 600;
            color: #374151;
        }

        .progress-percentage {
            font-size: 14px;
            color: #6B7280;
        }

        .progress-bar {
            width: 100%;
            height: 6px;
            background: #E5E7EB;
            border-radius: 3px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #10B981 0%, #059669 100%);
            border-radius: 3px;
            transition: width 0.5s ease;
        }

        .progress-steps {
            display: flex;
            justify-content: space-between;
            margin-top: 8px;
            font-size: 12px;
            color: #9CA3AF;
        }

        .step {
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .step.completed {
            color: #10B981;
        }

        .step.active {
            color: #3B82F6;
            font-weight: 600;
        }

        /* Profile Badge */
        .profile-badge {
            background: linear-gradient(135deg, #FEF3C7 0%, #F59E0B 100%);
            border-radius: 8px;
            padding: 8px 12px;
            margin-bottom: 16px;
            font-size: 13px;
            color: #92400E;
            display: none;
        }

        .profile-badge strong {
            color: #78350F;
        }

        /* Chat Messages */
        .chat-messages {
            flex: 1;
            overflow-y: auto;
            padding: 24px;
            display: flex;
            flex-direction: column;
            gap: 16px;
        }

        .message {
            display: flex;
            gap: 12px;
            max-width: 85%;
        }

        .message.user {
            align-self: flex-end;
            flex-direction: row-reverse;
        }

        .message-avatar {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 16px;
            flex-shrink: 0;
        }

        .message.ai .message-avatar {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .message.user .message-avatar {
            background: #10B981;
            color: white;
        }

        .message-content {
            flex: 1;
        }

        .message-bubble {
            padding: 12px 16px;
            border-radius: 16px;
            font-size: 15px;
            line-height: 1.5;
            word-wrap: break-word;
        }

        .message.ai .message-bubble {
            background: #F1F5F9;
            color: #374151;
            border-bottom-left-radius: 4px;
        }

        .message.user .message-bubble {
            background: #3B82F6;
            color: white;
            border-bottom-right-radius: 4px;
        }

        .message-time {
            font-size: 12px;
            color: #9CA3AF;
            margin-top: 4px;
            text-align: right;
        }

        .message.ai .message-time {
            text-align: left;
        }

        /* Interactive Elements */
        .choice-buttons {
            display: flex;
            gap: 8px;
            margin-top: 12px;
            flex-wrap: wrap;
        }

        .choice-btn {
            padding: 8px 16px;
            background: white;
            border: 1px solid #D1D5DB;
            border-radius: 20px;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .choice-btn:hover {
            background: #F9FAFB;
            border-color: #3B82F6;
        }

        .choice-btn.selected {
            background: #3B82F6;
            color: white;
            border-color: #3B82F6;
        }

        /* Persona Selection */
        .persona-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 12px;
            margin: 12px 0;
        }

        .persona-card {
            background: white;
            border: 2px solid #E5E7EB;
            border-radius: 12px;
            padding: 16px;
            cursor: pointer;
            transition: all 0.2s ease;
            text-align: center;
        }

        .persona-card:hover {
            border-color: #3B82F6;
            box-shadow: 0 4px 12px rgba(59, 130, 246, 0.1);
        }

        .persona-card.selected {
            border-color: #10B981;
            background: #F0FDF4;
        }

        .persona-icon {
            font-size: 32px;
            margin-bottom: 8px;
        }

        .persona-title {
            font-size: 16px;
            font-weight: 600;
            color: #111827;
            margin-bottom: 4px;
        }

        .persona-desc {
            font-size: 13px;
            color: #6B7280;
            line-height: 1.4;
        }

        /* Product Input */
        .product-input-container {
            background: #F8FAFC;
            border: 1px solid #E2E8F0;
            border-radius: 12px;
            padding: 16px;
            margin: 12px 0;
        }

        .product-input-label {
            font-size: 14px;
            font-weight: 600;
            color: #374151;
            margin-bottom: 8px;
        }

        .product-input {
            width: 100%;
            padding: 8px 12px;
            border: 1px solid #D1D5DB;
            border-radius: 8px;
            font-size: 14px;
            outline: none;
            margin-bottom: 8px;
        }

        .product-input:focus {
            border-color: #3B82F6;
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }

        .product-examples {
            font-size: 12px;
            color: #9CA3AF;
        }

        /* Step Indicator */
        .step-indicator {
            background: linear-gradient(90deg, #EBF8FF 0%, #DBEAFE 100%);
            border: 1px solid #93C5FD;
            border-radius: 12px;
            padding: 12px 16px;
            margin: 8px 0;
            font-size: 14px;
            color: #1E40AF;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .step-number {
            background: #3B82F6;
            color: white;
            width: 24px;
            height: 24px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            font-weight: 600;
        }

        /* Collaboration Hints */
        .collab-hint {
            background: #FEF3C7;
            border: 1px solid #F59E0B;
            border-radius: 8px;
            padding: 8px 12px;
            margin: 8px 0;
            font-size: 13px;
            color: #92400E;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        /* Input Area */
        .chat-input-area {
            padding: 20px 24px;
            background: #FAFBFC;
            border-top: 1px solid #E5E7EB;
        }

        .input-container {
            display: flex;
            gap: 12px;
            align-items: flex-end;
        }

        .input-field {
            flex: 1;
            padding: 12px 16px;
            border: 2px solid #E5E7EB;
            border-radius: 24px;
            font-size: 15px;
            resize: none;
            outline: none;
            min-height: 44px;
            max-height: 120px;
            font-family: inherit;
            transition: border-color 0.2s ease;
        }

        .input-field:focus {
            border-color: #3B82F6;
        }

        .input-field::placeholder {
            color: #9CA3AF;
        }

        .send-btn {
            width: 44px;
            height: 44px;
            background: #3B82F6;
            color: white;
            border: none;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
            transition: all 0.2s ease;
        }

        .send-btn:hover {
            background: #2563EB;
            transform: scale(1.05);
        }

        .send-btn:disabled {
            background: #D1D5DB;
            cursor: not-allowed;
            transform: none;
        }

        /* Quick Actions */
        .quick-actions {
            display: flex;
            gap: 8px;
            margin-bottom: 12px;
            flex-wrap: wrap;
        }

        .quick-action {
            padding: 6px 12px;
            background: white;
            border: 1px solid #D1D5DB;
            border-radius: 16px;
            font-size: 13px;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .quick-action:hover {
            background: #F3F4F6;
            border-color: #9CA3AF;
        }

        /* Typing Indicator */
        .typing-indicator {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 12px 16px;
            background: #F1F5F9;
            border-radius: 16px;
            border-bottom-left-radius: 4px;
            font-size: 14px;
            color: #6B7280;
        }

        .typing-dots {
            display: flex;
            gap: 3px;
        }

        .typing-dot {
            width: 6px;
            height: 6px;
            background: #9CA3AF;
            border-radius: 50%;
            animation: typing 1.4s infinite;
        }

        .typing-dot:nth-child(2) {
            animation-delay: 0.2s;
        }

        .typing-dot:nth-child(3) {
            animation-delay: 0.4s;
        }

        @keyframes typing {
            0%, 60%, 100% {
                transform: translateY(0);
                opacity: 0.4;
            }
            30% {
                transform: translateY(-8px);
                opacity: 1;
            }
        }

        /* Responsive */
        @media (max-width: 768px) {
            .chat-container {
                height: 100vh;
                border-radius: 0;
            }

            .chat-header {
                padding: 16px 20px;
            }

            .setup-container, .progress-container, .chat-messages, .chat-input-area {
                padding-left: 20px;
                padding-right: 20px;
            }

            .choice-buttons {
                flex-direction: column;
            }

            .choice-btn {
                text-align: center;
            }

            .persona-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="chat-container">
        <!-- Header -->
        <div class="chat-header">
            <div class="header-left">
                <div class="ai-avatar">🎨</div>
                <div class="ai-info">
                    <h3>ProductAI</h3>
                    <div class="ai-status">
                        <div class="status-dot"></div>
                        제품 디자인 파트너
                    </div>
                </div>
            </div>
            <div class="project-info">
                <div id="projectTitle">새 프로젝트</div>
                <div style="font-size: 12px; opacity: 0.8;">함께 시작해보세요</div>
            </div>
        </div>

        <!-- Setup Progress -->
        <div class="setup-container" id="setupContainer">
            <div class="setup-header">
                <div class="setup-title">프로젝트 설정</div>
                <div class="setup-indicator" id="setupIndicator">1/3 단계</div>
            </div>
            <div class="setup-steps">
                <div class="setup-step active" id="step1">역할 정의</div>
                <div class="setup-step pending" id="step2">제품 정의</div>
                <div class="setup-step pending" id="step3">목표 설정</div>
            </div>
        </div>

        <!-- Project Progress (Hidden initially) -->
        <div class="progress-container" id="progressContainer">
            <div class="progress-header">
                <div class="progress-title">프로젝트 진행률</div>
                <div class="progress-percentage" id="progressText">0/6 단계 완료</div>
            </div>
            <div class="progress-bar">
                <div class="progress-fill" id="progressFill" style="width: 0%"></div>
            </div>
            <div class="progress-steps">
                <div class="step pending">🔍 리서치</div>
                <div class="step pending">💡 아이디어</div>
                <div class="step pending">📋 기획</div>
                <div class="step pending">🎨 디자인</div>
                <div class="step pending">🔧 프로토타입</div>
                <div class="step pending">✅ 검증</div>
            </div>
        </div>

        <!-- Messages -->
        <div class="chat-messages" id="chatMessages">
            <!-- Profile Badge (Hidden initially) -->
            <div class="profile-badge" id="profileBadge">
                <strong>시니어 제품 디자이너</strong>로 <strong>스마트워치 헬스케어 앱</strong> 프로젝트를 진행 중입니다
            </div>

            <!-- Initial AI Message -->
            <div class="message ai">
                <div class="message-avatar">🤖</div>
                <div class="message-content">
                    <div class="message-bubble">
                        안녕하세요! 제품 디자인 프로젝트를 함께 진행할 ProductAI입니다. 😊
                        
                        <div class="step-indicator">
                            <div class="step-number">1</div>
                            먼저 어떤 역할로 프로젝트를 진행하실 건지 알려주세요!
                        </div>

                        <div class="persona-grid">
                            <div class="persona-card" onclick="selectPersona('junior', '주니어 제품 디자이너')">
                                <div class="persona-icon">🌱</div>
                                <div class="persona-title">주니어 디자이너</div>
                                <div class="persona-desc">기초부터 차근차근 배우면서 진행하고 싶어요</div>
                            </div>
                            <div class="persona-card" onclick="selectPersona('senior', '시니어 제품 디자이너')">
                                <div class="persona-icon">🎯</div>
                                <div class="persona-title">시니어 디자이너</div>
                                <div class="persona-desc">전략적 관점에서 체계적으로 접근하고 싶어요</div>
                            </div>
                            <div class="persona-card" onclick="selectPersona('pm', '제품 기획자')">
                                <div class="persona-icon">📊</div>
                                <div class="persona-title">제품 기획자</div>
                                <div class="persona-desc">비즈니스 관점에서 효율적으로 진행하고 싶어요</div>
                            </div>
                        </div>
                    </div>
                    <div class="message-time">방금 전</div>
                </div>
            </div>
        </div>

        <!-- Input Area -->
        <div class="chat-input-area">
            <div class="quick-actions" id="quickActions">
                <button class="quick-action" onclick="quickAction('도움말')">❓ 도움말</button>
                <button class="quick-action" onclick="quickAction('예시 보기')">💡 예시 보기</button>
                <button class="quick-action" onclick="quickAction('처음부터')">🔄 처음부터</button>
            </div>
            <div class="input-container">
                <textarea 
                    class="input-field" 
                    id="messageInput"
                    placeholder="역할을 선택하거나 직접 입력해주세요..."
                    rows="1"
                    onkeypress="handleKeyPress(event)"
                    oninput="autoResize(this)"
                ></textarea>
                <button class="send-btn" onclick="sendMessage()" id="sendBtn">
                    ➤
                </button>
            </div>
        </div>
    </div>

    <script>
        let currentSetupStep = 1;
        let currentProjectStep = 0;
        let totalProjectSteps = 6;
        let userPersona = '';
        let productTitle = '';
        let projectGoal = '';
        let isTyping = false;
        let isSetupComplete = false;

        // Persona Selection
        function selectPersona(persona, personaName) {
            // Visual feedback
            document.querySelectorAll('.persona-card').forEach(card => {
                card.classList.remove('selected');
            });
            event.currentTarget.classList.add('selected');
            
            userPersona = persona;
            
            // Send user message
            setTimeout(() => {
                addUserMessage(`${personaName}로 진행하겠습니다.`);
                
                setTimeout(() => {
                    moveToNextSetupStep();
                    askForProduct();
                }, 1500);
            }, 500);
        }

        // Setup Step Management
        function moveToNextSetupStep() {
            // Update current step
            document.getElementById(`step${currentSetupStep}`).classList.remove('active');
            document.getElementById(`step${currentSetupStep}`).classList.add('completed');
            
            currentSetupStep++;
            
            if (currentSetupStep <= 3) {
                document.getElementById(`step${currentSetupStep}`).classList.add('active');
                document.getElementById('setupIndicator').textContent = `${currentSetupStep}/3 단계`;
            }
        }

        function askForProduct() {
            const messages = {
                'junior': '좋습니다! 이제 어떤 제품을 디자인해볼까요? 처음이라면 간단한 제품부터 시작하는 것을 추천해요.',
                'senior': '훌륭한 선택입니다. 이제 어떤 제품에 대한 전략적 디자인을 진행할지 알려주세요.',
                'pm': '좋습니다! 어떤 제품의 기획과 디자인을 진행할지 정의해주세요.'
            };

            addAIMessage(`
                ${messages[userPersona]}
                
                <div class="step-indicator">
                    <div class="step-number">2</div>
                    디자인할 제품을 구체적으로 알려주세요
                </div>

                <div class="product-input-container">
                    <div class="product-input-label">제품명</div>
                    <input type="text" class="product-input" id="productInput" placeholder="예: 스마트워치 헬스케어 앱" onkeypress="handleProductInput(event)">
                    <div class="product-examples">예시: 모바일 쇼핑 앱, IoT 스마트홈 제어기, 전기차 대시보드</div>
                </div>

                <div class="choice-buttons">
                    <button class="choice-btn" onclick="selectProduct('스마트워치 헬스케어 앱')">⌚ 스마트워치 헬스케어 앱</button>
                    <button class="choice-btn" onclick="selectProduct('모바일 음식 주문 앱')">🍔 모바일 음식 주문 앱</button>
                    <button class="choice-btn" onclick="selectProduct('스마트홈 제어 패널')">🏠 스마트홈 제어 패널</button>
                </div>
            `);
        }

        function handleProductInput(event) {
            if (event.key === 'Enter') {
                const input = document.getElementById('productInput');
                const product = input.value.trim();
                if (product) {
                    selectProduct(product);
                }
            }
        }

        function selectProduct(product) {
            productTitle = product;
            
            // Update header
            document.getElementById('projectTitle').textContent = product;
            
            // Send user message
            addUserMessage(`"${product}" 디자인을 진행하겠습니다.`);
            
            setTimeout(() => {
                moveToNextSetupStep();
                askForGoal();
            }, 1500);
        }

        function askForGoal() {
            const messages = {
                'junior': '멋진 제품이네요! 마지막으로 이 프로젝트를 통해 무엇을 배우거나 달성하고 싶으신지 알려주세요.',
                'senior': `${productTitle}의 핵심 가치와 해결하고자 하는 문제를 정의해주세요.`,
                'pm': '이제 프로젝트의 성공 지표와 주요 목표를 설정해보겠습니다.'
            };

            addAIMessage(`
                ${messages[userPersona]}
                
                <div class="step-indicator">
                    <div class="step-number">3</div>
                    프로젝트 목표를 설정해주세요
                </div>

                <div class="choice-buttons">
                    <button class="choice-btn" onclick="selectGoal('사용자 경험 개선')">✨ 사용자 경험 개선</button>
                    <button class="choice-btn" onclick="selectGoal('새로운 기능 추가')">🚀 새로운 기능 추가</button>
                    <button class="choice-btn" onclick="selectGoal('전체적인 리디자인')">🎨 전체적인 리디자인</button>
                    <button class="choice-btn" onclick="selectGoal('처음부터 새로 만들기')">🆕 처음부터 새로 만들기</button>
                </div>
            `);
        }

        function selectGoal(goal) {
            projectGoal = goal;
            
            // Send user message
            addUserMessage(`목표: ${goal}`);
            
            setTimeout(() => {
                completeSetup();
            }, 1500);
        }

        function completeSetup() {
            // Hide setup, show progress
            document.getElementById('setupContainer').style.display = 'none';
            document.getElementById('progressContainer').style.display = 'block';
            
            // Show profile badge
            const profileBadge = document.getElementById('profileBadge');
            const personaNames = {
                'junior': '주니어 제품 디자이너',
                'senior': '시니어 제품 디자이너', 
                'pm': '제품 기획자'
            };
            
            profileBadge.innerHTML = `<strong>${personaNames[userPersona]}</strong>로 <strong>${productTitle}</strong> 프로젝트를 진행 중입니다`;
            profileBadge.style.display = 'block';
            
            isSetupComplete = true;
            
            // Start project
            setTimeout(() => {
                startProject();
            }, 1000);
        }

        function startProject() {
            const startMessages = {
                'junior': `설정이 완료되었습니다! 이제 ${productTitle}를 단계별로 디자인해보겠습니다. 

                <div class="collab-hint">
                    💡 언제든지 질문하거나 다른 방향으로 가고 싶으시면 말씀해주세요!
                </div>

                첫 번째 단계인 리서치부터 시작해볼까요? 어떤 방식으로 진행하고 싶으신가요?`,
                
                'senior': `프로젝트 설정이 완료되었습니다. ${productTitle}의 전략적 디자인 프로세스를 시작하겠습니다.

                <div class="step-indicator">
                    <div class="step-number">🔍</div>
                    사용자 리서치 및 시장 분석 단계입니다
                </div>

                체계적인 접근을 위해 어떤 리서치 방법론을 우선적으로 적용하시겠습니까?`,
                
                'pm': `프로젝트 킥오프가 완료되었습니다! ${productTitle}의 효율적인 개발을 위한 로드맵을 함께 수립하겠습니다.

                먼저 시장 검증과 사용자 니즈 파악을 위한 리서치를 진행해야 합니다. 어떤 우선순위로 접근하시겠습니까?`
            };

            const choicesByPersona = {
                'junior': [
                    '🔍 사용자 인터뷰부터',
                    '📊 경쟁사 분석부터', 
                    '💭 아이디어 브레인스토밍부터'
                ],
                'senior': [
                    '📈 시장 분석 및 트렌드 조사',
                    '👥 사용자 페르소나 정의',
                    '🎯 디자인 전략 수립'
                ],
                'pm': [
                    '💼 비즈니스 요구사항 정의',
                    '📊 시장 검증 및 경쟁 분석',
                    '⚡ MVP 기능 우선순위 설정'
                ]
            };

            addAIMessage(`
                ${startMessages[userPersona]}
                
                <div class="choice-buttons">
                    ${choicesByPersona[userPersona].map(choice => 
                        `<button class="choice-btn" onclick="selectFirstStep('${choice}')">${choice}</button>`
                    ).join('')}
                </div>
            `);

            // Update quick actions for project phase
            updateQuickActions();
        }

        function updateQuickActions() {
            const quickActions = document.getElementById('quickActions');
            quickActions.innerHTML = `
                <button class="quick-action" onclick="quickAction('진행 상황 보기')">📊 진행 상황 보기</button>
                <button class="quick-action" onclick="quickAction('다른 방법으로')">🔄 다른 방법으로</button>
                <button class="quick-action" onclick="quickAction('도움 요청')">🙋‍♀️ 도움 요청</button>
                <button class="quick-action" onclick="quickAction('설정 변경')">⚙️ 설정 변경</button>
            `;
        }

        function selectFirstStep(step) {
            // Mark button as selected
            event.target.classList.add('selected');
            
            // Disable other buttons
            const buttons = event.target.parentNode.querySelectorAll('.choice-btn');
            buttons.forEach(btn => {
                if (btn !== event.target) {
                    btn.disabled = true;
                    btn.style.opacity = '0.5';
                }
            });

            // Send user message
            addUserMessage(step);
            
            // Update progress
            setTimeout(() => {
                updateProjectProgress();
                respondToFirstStep(step);
            }, 1500);
        }

        function updateProjectProgress() {
            currentProjectStep = 1;
            const percentage = Math.round((currentProjectStep / totalProjectSteps) * 100);
            
            document.getElementById('progressFill').style.width = percentage + '%';
            document.getElementById('progressText').textContent = `${currentProjectStep}/${totalProjectSteps} 단계 완료`;
            
            // Update step indicators
            const steps = document.querySelectorAll('.progress-steps .step');
            if (steps[0]) {
                steps[0].classList.remove('pending');
                steps[0].classList.add('active');
                steps[0].innerHTML = '🔄 리서치 (진행중)';
            }
        }

        function respondToFirstStep(step) {
            const responses = {
                '🔍 사용자 인터뷰부터': `훌륭한 시작이에요! 사용자 인터뷰는 실제 니즈를 파악하는 가장 직접적인 방법입니다.

                <div class="collab-hint">
                    🎯 ${productTitle} 사용자들의 실제 경험을 들어보겠습니다
                </div>

                어떤 사용자층을 먼저 인터뷰하고 싶으신가요?
                - 기존 유사 제품 사용자
                - 잠재적 타겟 사용자 
                - 전문가 및 얼리어답터

                구체적인 인터뷰 계획을 세워보겠습니다!`,

                '📊 경쟁사 분석부터': `현명한 접근법이네요! 시장에서 이미 검증된 솔루션들을 분석하면 더 나은 전략을 세울 수 있어요.

                ${productTitle}와 유사한 제품들을 분석해보면서:
                1. 각 제품의 강점과 약점
                2. 사용자들의 주요 불만사항
                3. 우리가 차별화할 수 있는 포인트

                어떤 제품부터 분석해보실까요?`,

                '📈 시장 분석 및 트렌드 조사': `전략적 접근 방식이군요! 시장 전체를 이해하는 것부터 시작하겠습니다.

                <div class="step-indicator">
                    <div class="step-number">📈</div>
                    시장 규모, 성장률, 주요 트렌드를 파악하겠습니다
                </div>

                다음 관점에서 분석을 진행하겠습니다:
                - 시장 규모 및 성장 전망
                - 주요 플레이어 분석
                - 기술 트렌드 및 사용자 행동 변화

                어떤 영역에 더 집중하고 싶으신가요?`,

                '💼 비즈니스 요구사항 정의': `체계적인 시작입니다! 명확한 비즈니스 목표가 있어야 성공적인 제품을 만들 수 있죠.

                다음 요소들을 정의해보겠습니다:
                - 핵심 비즈니스 목표
                - 성공 지표 (KPI)
                - 제약사항 및 고려사항
                - 타임라인 및 리소스

                가장 우선적으로 정의하고 싶은 부분은 무엇인가요?`
            };

            const defaultResponse = `좋은 선택이에요! ${step}로 시작하겠습니다. 

            단계별로 차근차근 진행하면서 ${productTitle}의 완성도 높은 디자인을 만들어보겠습니다.

            구체적으로 어떤 부분부터 시작하고 싶으신가요?`;

            addAIMessage(responses[step] || defaultResponse);
        }

        // Message Functions
        function addUserMessage(text) {
            const messagesContainer = document.getElementById('chatMessages');
            const messageDiv = document.createElement('div');
            messageDiv.className = 'message user';
            messageDiv.innerHTML = `
                <div class="message-avatar">👤</div>
                <div class="message-content">
                    <div class="message-bubble">${text}</div>
                    <div class="message-time">방금 전</div>
                </div>
            `;
            messagesContainer.appendChild(messageDiv);
            scrollToBottom();
        }

        function addAIMessage(text) {
            showTypingIndicator();
            
            setTimeout(() => {
                hideTypingIndicator();
                
                const messagesContainer = document.getElementById('chatMessages');
                const messageDiv = document.createElement('div');
                messageDiv.className = 'message ai';
                
                messageDiv.innerHTML = `
                    <div class="message-avatar">🤖</div>
                    <div class="message-content">
                        <div class="message-bubble">
                            ${text}
                        </div>
                        <div class="message-time">방금 전</div>
                    </div>
                `;
                messagesContainer.appendChild(messageDiv);
                scrollToBottom();
            }, 2000);
        }

        // Quick Actions
        function quickAction(action) {
            addUserMessage(action);
            
            setTimeout(() => {
                const responses = {
                    '도움말': '어떤 부분에서 도움이 필요하신지 구체적으로 말씀해주세요. 단계별 가이드, 예시, 또는 다른 접근 방법을 제안해드릴 수 있어요!',
                    '예시 보기': '다양한 제품 디자인 예시를 보여드릴게요. 어떤 종류의 예시가 궁금하신가요?',
                    '처음부터': '새롭게 시작하시겠어요? 역할이나 제품을 다시 선택하실 수 있습니다.',
                    '진행 상황 보기': `현재 ${currentProjectStep}/${totalProjectSteps} 단계를 진행 중입니다. 다음 단계로 넘어가거나 현재 단계를 더 자세히 다룰 수 있어요.`,
                    '다른 방법으로': '다른 접근 방식을 시도해보시겠어요? 어떤 방향으로 바꾸고 싶으신지 알려주세요.',
                    '도움 요청': '막힌 부분이나 어려운 점이 있으시면 언제든 말씀해주세요. 함께 해결해보겠습니다!',
                    '설정 변경': '역할이나 제품, 목표를 변경하고 싶으시다면 알려주세요. 언제든 수정할 수 있어요.'
                };
                
                addAIMessage(responses[action] || '더 자세히 설명해주시면 도와드리겠습니다.');
            }, 1000);
        }

        // Input Handling
        function handleKeyPress(event) {
            if (event.key === 'Enter' && !event.shiftKey) {
                event.preventDefault();
                sendMessage();
            }
        }

        function sendMessage() {
            const input = document.getElementById('messageInput');
            const text = input.value.trim();
            
            if (!text || isTyping) return;
            
            addUserMessage(text);
            input.value = '';
            autoResize(input);
            
            // Generate AI response based on user input
            setTimeout(() => {
                generateAIResponse(text);
            }, 1000);
        }

        function generateAIResponse(userText) {
            if (!isSetupComplete) {
                // During setup phase
                if (currentSetupStep === 1) {
                    // Manual persona input
                    userPersona = 'custom';
                    addAIMessage('좋습니다! 이제 어떤 제품을 디자인할지 알려주세요.');
                    moveToNextSetupStep();
                    setTimeout(askForProduct, 1000);
                } else if (currentSetupStep === 2) {
                    // Manual product input
                    selectProduct(userText);
                } else if (currentSetupStep === 3) {
                    // Manual goal input
                    selectGoal(userText);
                }
                return;
            }

            // During project phase
            const responses = [
                '좋은 관점이네요! 그 부분을 더 구체적으로 발전시켜볼까요?',
                '사용자 관점에서 정말 중요한 포인트를 짚어주셨네요. 이런 방식으로 접근해보면 어떨까요?',
                `${productTitle} 프로젝트에 딱 맞는 접근법이에요! 다음 단계로 넘어가볼까요?`,
                '그 방향으로 진행해보겠습니다. 단계별로 하나씩 만들어가요!',
                '흥미로운 아이디어네요! 실제 구현 시 고려해야 할 점들을 함께 살펴보겠습니다.'
            ];
            
            const randomResponse = responses[Math.floor(Math.random() * responses.length)];
            addAIMessage(randomResponse);

            // Occasionally progress the project
            if (Math.random() > 0.7 && currentProjectStep < totalProjectSteps) {
                setTimeout(() => {
                    advanceProject();
                }, 3000);
            }
        }

        function advanceProject() {
            currentProjectStep++;
            const percentage = Math.round((currentProjectStep / totalProjectSteps) * 100);
            
            document.getElementById('progressFill').style.width = percentage + '%';
            document.getElementById('progressText').textContent = `${currentProjectStep}/${totalProjectSteps} 단계 완료`;
            
            // Update step indicators
            const steps = document.querySelectorAll('.progress-steps .step');
            const stepNames = ['리서치', '아이디어', '기획', '디자인', '프로토타입', '검증'];
            
            if (steps[currentProjectStep - 2]) {
                steps[currentProjectStep - 2].classList.remove('active');
                steps[currentProjectStep - 2].classList.add('completed');
                steps[currentProjectStep - 2].innerHTML = `✅ ${stepNames[currentProjectStep - 2]}`;
            }
            
            if (steps[currentProjectStep - 1]) {
                steps[currentProjectStep - 1].classList.remove('pending');
                steps[currentProjectStep - 1].classList.add('active');
                steps[currentProjectStep - 1].innerHTML = `🔄 ${stepNames[currentProjectStep - 1]} (진행중)`;
            }

            // Progress notification
            setTimeout(() => {
                addAIMessage(`🎉 좋은 진전이에요! ${stepNames[currentProjectStep - 1]} 단계로 넘어갔습니다. 계속해서 ${productTitle}를 발전시켜나가요!`);
            }, 1000);
        }

        // UI Functions
        function autoResize(textarea) {
            textarea.style.height = 'auto';
            textarea.style.height = textarea.scrollHeight + 'px';
        }

        function scrollToBottom() {
            const messagesContainer = document.getElementById('chatMessages');
            messagesContainer.scrollTop = messagesContainer.scrollHeight;
        }

        function showTypingIndicator() {
            if (isTyping) return;
            isTyping = true;
            
            const messagesContainer = document.getElementById('chatMessages');
            const typingDiv = document.createElement('div');
            typingDiv.className = 'message ai';
            typingDiv.id = 'typingIndicator';
            typingDiv.innerHTML = `
                <div class="message-avatar">🤖</div>
                <div class="message-content">
                    <div class="typing-indicator">
                        <div class="typing-dots">
                            <div class="typing-dot"></div>
                            <div class="typing-dot"></div>
                            <div class="typing-dot"></div>
                        </div>
                        생각 중...
                    </div>
                </div>
            `;
            messagesContainer.appendChild(typingDiv);
            scrollToBottom();
        }

        function hideTypingIndicator() {
            const typingIndicator = document.getElementById('typingIndicator');
            if (typingIndicator) {
                typingIndicator.remove();
            }
            isTyping = false;
        }

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            scrollToBottom();
            document.getElementById('messageInput').focus();
        });
    </script>
</body>
</html>